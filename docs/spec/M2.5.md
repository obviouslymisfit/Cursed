# CURSED — Milestone M2.5
## Initial Team Deployment (Run Start Scatter Teleport)

---

## 0. CRITICAL IMPLEMENTATION RULE (APPLIES TO THIS AND ALL FUTURE MILESTONES)

When implementing this milestone (and every milestone thereafter):

- All non-trivial code MUST include explicit, explanatory comments written as the code is created.
- Comments must explain:
    - what the code does
    - why it exists
    - how it fits into the larger system
- Comments must be understandable to a third party with zero project context.

“Comment later” is not allowed.

---

## 1. Purpose

CURSED relies on the spawn platform as the delivery anchor. To force meaningful travel (and prevent “spawn-camping” the delivery chest), teams must be deployed away from spawn when a run begins.

This milestone defines a run-start-only mechanic:

- When a run is created / started for the first time,
  each team is teleported to a unique “deployment” location in the world.
- Deployment locations are:
    - far enough from spawn to force travel back for delivery gameplay
    - bounded by a configurable min/max radius
    - distributed so teams start at roughly equal separation from each other (no unfair clumping)

This is NOT an episode mechanic. This happens once per run creation/start, not on every episode start.

---

## 2. Locked Behavior (What MUST happen)

### 2.1 One-time run start deployment
- Deployment teleport happens exactly once, when a run is started for the first time.
- After this initial deployment:
    - episode start should restore each player’s saved position (episode system behavior)
    - episode end should return players to spawn platform (episode system behavior)

### 2.2 Deployment is team-based
- The deployment location is computed per team.
- All members of a team are teleported to their team’s deployment location (or safe nearby offsets).

### 2.3 Configurable distance from spawn (min/max radius)
- The deployment location must be at a distance from the spawn platform within:
    - min radius (inclusive)
    - max radius (inclusive)
- These values are server gameplay knobs (tuning), not hardcoded constants.

### 2.4 Fair distribution between teams (roughly equal spacing)
To avoid unfair starts, teams should not be clumped into nearby regions.

Locked fairness outcome:
- Teams must be distributed around spawn so that neighbor distances are roughly equal.

Implementation freedom:
- You may achieve this by placing teams on a ring by angle:
    - take N teams
    - compute angles evenly: 360° / N
    - add a random global rotation offset so starts are not always in the same compass directions
    - choose a radius per team within [min,max] (either fixed mid-radius or randomized with constraints)
- Alternative strategies are allowed if they produce the same fairness outcome.

---

## 3. Safety and Validity Rules

### 3.1 World safety
Deployment location must be a valid teleport destination:
- correct dimension (Overworld unless explicitly changed later)
- safe Y (not inside blocks, not under bedrock, not void)
- avoid liquid-only landings when possible

If a candidate location is unsafe:
- the system retries with a new candidate location
- retry must be bounded (max attempts)
- if it still fails, fall back to a safe nearby location or a known safe default strategy

### 3.2 Team separation minimum (optional but recommended)
To enforce fairness further, we may add an optional “minimum distance between team deployment points”.
If present, it must be a server gameplay knob.

If not implemented initially, the ring distribution is still expected to provide reasonable separation.

---

## 4. Persistence Requirements

The run must persist enough state to guarantee this is one-time:
- a boolean (or equivalent) that initial deployment has occurred
- the chosen deployment location per team (recommended, so it can be reused for debugging / admin inspection)

If a restart happens mid-run:
- the system must not “re-deploy” teams again on restart

---

## 5. UI / Player Visibility

Players do not need a UI explanation of the deployment algorithm.
However:
- Admin/debug commands may include an inspection command to print each team’s deployment coordinates (development only).
- Players should not be told that deployment is “fair” or how it is computed.

---

## 6. Configuration (Gameplay Knobs)

These values belong in server gameplay config (gameplay knobs), not debug config:

- deployment.enabled (boolean)
- deployment.minRadiusBlocks (int)
- deployment.maxRadiusBlocks (int)
- deployment.strategy (enum; default: RING_EQUAL_ANGLES)
- deployment.maxAttemptsPerTeam (int; retry bound)
- optional: deployment.minDistanceBetweenTeamsBlocks (int)

This milestone defines the knobs even if not all are fully exploited immediately.

---

## 7. Implementation Checklist (Future Coding Chat Must Follow)

When implementing M2.5, the coding chat must:

1) Confirm the spawn platform location source (the canonical “spawn platform anchor”).
2) Add gameplay config entries for deployment knobs (server config).
3) Implement deployment point selection strategy (ring equal angles recommended).
4) Implement safety validation + retry.
5) Implement team teleport using deployment points.
6) Persist:
    - deployment-performed flag
    - per-team deployment location (recommended)
7) Add admin/debug visibility command(s) (optional but recommended) to inspect deployment points.
8) Compile and verify on a local server:
    - N teams get distributed around spawn
    - distances respect min/max radius
    - restart does not redeploy
    - episode start/end system remains separate from deployment behavior
