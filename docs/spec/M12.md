# CURSED — Milestone M12
## New Run Creation & Manual Restart Flow

---

## 0. CRITICAL IMPLEMENTATION RULE (APPLIES TO THIS AND ALL FUTURE MILESTONES)

When implementing this milestone (and every milestone thereafter):

- **All non-trivial code MUST include explicit, explanatory comments**
- Comments must:
    - explain **what the code does**
    - explain **why it exists**
    - explain **how it fits into the larger system**
- Comments must be written so that:
    - a third party with no prior context
    - or a future maintainer months/years later  
      can understand the intent and structure without external documentation

This is not optional.  
Lack of clear comments is considered incomplete implementation.

### COMMENTING RULE (CLARIFICATION — NON-NEGOTIABLE)

- Comments are written **at the moment code is created**, not afterward.
- There is **no separate “commenting phase”**.
- No class, method, or non-trivial logic may exist without comments explaining:
    - its responsibility
    - its boundaries
    - and why it exists at that location in the system.
- If a piece of code cannot be clearly commented while being written, implementation **must pause** and the design must be reconsidered.
- “We will add comments later” is considered **invalid and incomplete implementation**.

---

## 1. Purpose of M12

Milestone M12 defines how a **brand-new run** is created after the previous run has ended.

CURSED does not automatically restart itself.  
A new run is always a **deliberate administrative action**.

M12 ensures that starting a new run:
- is explicit
- is safe
- does not leak any state from the previous run
- cleanly reinitializes all systems
- places all players into a known, controlled starting position

---

## 2. Scope

### Included in M12
- Admin-only command(s) to create a new run
- Creation of a **new run instance** (not reuse)
- Full reset of all run-scoped systems
- Safety checks to prevent accidental resets
- Teleporting all players to spawn platform
- Optional confirmation / force mechanism

### Explicitly Excluded from M12
- Automatic run start
- Rewards or persistence
- Episode logic changes
- Team creation logic
- UI changes beyond basic messaging
- World reset or rollback

---

## 3. Authority & Permissions (Locked)

- Only **admin / op / permission-gated users** may create a new run.
- Normal players can never reset or start a run.
- All commands must fail loudly if invoked without permission.

---

## 4. New Run Creation Model (Locked)

### New run means a new object

Starting a new run:
- **creates a brand-new run instance**
- assigns a new runId
- does not reuse or mutate the previous run object

This avoids:
- state leakage
- partial resets
- hard-to-debug edge cases

---

## 5. Full Hard Reset Semantics (Locked)

When a new run is created, **all run-scoped state is reset**, including but not limited to:

- runId (new)
- lifecycle state (PAUSED initially)
- global phase (reset to phase 1)
- objectives (regenerated)
- tasks (regenerated)
- completion state (cleared)
- team scores (reset)
- penalties (cleared)
- curses (regenerated)
- episode counters and timers (reset)
- runtime caches (cleared)

Nothing from the previous run carries over.

---

## 6. Safety Checks Before New Run Creation

### Default behavior (locked)

A new run **may only be created if the current run is terminal**:
- COMPLETED
- FAILED
- ABORTED

If the current run is still RUNNING or PAUSED:
- the command must fail
- a clear message must explain why

### Optional override (explicit, dangerous)

A separate **confirm/force command** may exist, such as:
/curse run new --force

This command:
- forcibly terminates the current run
- immediately creates a new run
- must be:
    - explicitly named
    - permission-gated
    - loudly logged

This exists only for recovery/testing.

---

## 7. Player Positioning on New Run Start (Locked)

When a new run is created:
- **all online players are teleported to the spawn platform**
- regardless of team
- regardless of previous position or dimension

This ensures:
- a clean starting point
- no accidental interaction with leftover world context
- consistency with episode and delivery mechanics

---

## 8. Lifecycle After New Run Creation

After creation:
- the new run starts in **PAUSED** state
- no episode is active yet
- no objectives or tasks progress
- admin must explicitly start/resume the run to begin a new episode

M12 does not auto-start gameplay.

---

## 9. Messaging & Feedback

When a new run is created:
- admins receive confirmation
- players receive a clear message:
    - “A new run has been created”
- no titles or cinematic messaging is required

This is a structural event, not a dramatic one.

---

## 10. Debug / Admin Observability

Debug/admin tooling may expose:
- current runId
- lifecycle state
- whether a run exists
- whether a new run can be created safely

This is for testing and recovery only.

---

## 11. Explicit Implementation Steps (STRICT ORDER)

1. Add admin command to create a new run
2. Enforce permission checks
3. Enforce terminal-state safety check
4. Implement optional force/confirm override
5. Create a new run instance with fresh runId
6. Initialize all run-scoped systems from scratch
7. Persist new run state
8. Teleport all online players to spawn platform
9. Validate no old state remains reachable
10. Ensure new run starts in PAUSED state
11. **Verify that all code written during this milestone was commented at creation time**

---

## 12. Result After M12

- CURSED supports clean, repeatable play cycles
- Admins can safely start a new game
- No state leakage between runs
- Players always restart from a known position
- The full lifecycle of the game is now complete
