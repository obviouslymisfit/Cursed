# CURSED — Milestone M10
## Player-Facing Runtime UI, Session Control & Messaging

---

## 0. CRITICAL IMPLEMENTATION RULE (APPLIES TO THIS AND ALL FUTURE MILESTONES)

When implementing this milestone (and every milestone thereafter):

- **All non-trivial code MUST include explicit, explanatory comments**
- Comments must:
    - explain **what the code does**
    - explain **why it exists**
    - explain **how it fits into the larger system**
- Comments must be written so that:
    - a third party with no prior context
    - or a future maintainer months/years later  
      can understand the intent and structure without external documentation

This is not optional.  
Lack of clear comments is considered incomplete implementation.

### COMMENTING RULE (CLARIFICATION — NON-NEGOTIABLE)

- Comments are written **at the moment code is created**, not afterward.
- There is **no separate “commenting phase”**.
- No class, method, or non-trivial logic may exist without comments explaining:
    - its responsibility
    - its boundaries
    - and why it exists at that location in the system.
- If a piece of code cannot be clearly commented while being written, implementation **must pause** and the design must be reconsidered.
- “We will add comments later” is considered **invalid and incomplete implementation**.

---

## 1. Purpose of M10

Milestone M10 introduces the **player-facing visibility layer** of CURSED.

The purpose of this milestone is **not** to explain the game systems, reveal secrets, or expose internals.  
Its purpose is to allow players to:

- orient themselves during a real-world play session (**episode**)
- understand the current state of the run
- see team standings and progress
- receive clear feedback when important events occur

M10 strictly **reads** from authoritative systems created in earlier milestones and **never mutates game state**.

---

## 2. Conceptual Alignment (Locked)

This milestone strictly follows the original CURSED design:

- **Run** = long-lived campaign instance (persistent)
- **Episode** = real-life play session window
- Episode boundaries are defined by the run entering/leaving `RUNNING`
- Episode time is **wallclock-based**
- Episode duration is configurable by admin
- Players return to the spawn platform when an episode ends
- Curses remain **completely secret**
- UI communicates outcomes, never causes

---

## 3. Sidebar Scoreboard (Primary HUD)

### Purpose
Provide a constant, low-noise overview of the current session.

### Sidebar contents (exact, ordered)

1. Game title (static)
2. Episode number
3. Episode timer (wallclock, countdown or elapsed)
4. Current global phase
5. Spacer
6. Team list (ordered by score):
    - team name (team color)
    - team score

### Rules
- Sidebar is visible to all players
- Same content for all players
- No objectives, tasks, or curse information
- Updates only when underlying state changes:
    - score changes
    - phase changes
    - episode start/end
- Never updates every tick

---

## 4. Episode Timer & Session Visibility

### Episode model (read-only in M10)

- Episode starts when run enters `RUNNING`
- Episode ends when run leaves `RUNNING`
- Episode timer is **wallclock-based**
- Episode duration is configurable via:
    - admin command
    - and/or data config

### UI behavior
- Timer shown in sidebar
- When episode ends:
    - timer stops
    - run pauses
    - players are returned to spawn platform (handled elsewhere)
- M10 only **displays** this state

---

## 5. Titles & Subtitles (Major Events Only)

Titles are used **sparingly** and only for events that change the macro state.

### Phase advancement (M4)
- Title: `Phase <N>`
- Subtitle: `New objectives unlocked`

### Episode start
- Title: `Episode <N>`
- Subtitle: `Run resumed`

### Run termination (M7)
- COMPLETED → `Run Completed`
- FAILED → `Run Failed`
- ABORTED → `Run Aborted`

### Rules
- Titles are never spammed
- Titles are never informational spam
- Titles are always backed by an authoritative state transition

---

## 6. Chat Messaging (Explicit, Non-Spammy)

### Used for:
- Objective completion (team-scoped)
- Task completion (team-scoped)
- Large score changes
- Penalty explanations (cause + amount)

### Rules
- Messages explain **what happened**
- Messages explain **why**, when non-obvious
- Messages are team-scoped unless globally relevant
- No curse information is ever revealed

### Examples
- `Objective completed: Deliver Supplies`
- `Task completed: Smelt 64 Iron`
- `Penalty applied: -50 points (death)`

---

## 7. Action Bar Feedback (Moment-to-Moment)

### Used for:
- Partial progress updates (e.g. deliver/gather)
- Minor score changes
- Temporary feedback that should not persist

### Rules
- Short-lived
- Overwritten by newer messages
- Player- or team-scoped
- No curse hints

---

## 8. Player-Facing Commands (Read-Only, Team-Scoped)

These commands exist to answer one question only:

> “How is **my team** doing right now?”

### `/curse status`
Displays:
- Episode number
- Episode timer
- Current phase
- Your team name
- Your team score
- Your team rank

---

### `/curse objectives`
Displays:
- Unlocked objectives for **your team only**
- PRIMARY and SECONDARY objectives
- Completion state
- Progress numbers (where applicable)

Locked objectives are **not shown**.

---

### `/curse tasks`
Displays:
- Unlocked tasks for **your team only**
- Completion state
- Progress numbers

Locked tasks are **not shown**.

---

### Command rules
- No global inspection
- No future phases
- No internal IDs
- No generator data
- No curse exposure
- If player has no team → graceful message

---

## 9. Suppression of Vanilla Messages (M10 Responsibility)

To avoid conflicting or misleading feedback, M10 suppresses:

- Vanilla death messages
- Vanilla advancement messages
- Other vanilla broadcasts that conflict with CURSED messaging

All meaningful feedback is routed through CURSED-controlled UI and messaging.

---

## 10. Failure & Edge Case Handling

- If run state is unavailable → UI fails silently
- Offline players do not block UI updates
- Restart:
    - sidebar rebuilds immediately
    - episode state restored correctly
- Players joining mid-episode:
    - receive correct sidebar immediately
    - no retroactive spam

---

## 11. Explicit Implementation Steps (STRICT ORDER)

1. Implement sidebar builder and update service (read-only)
2. Bind sidebar updates to score, phase, and episode changes
3. Implement episode timer display logic
4. Implement title/subtitle triggers for major events
5. Implement chat messaging helpers
6. Implement action bar helpers
7. Implement player-facing commands:
    - `/curse status`
    - `/curse objectives`
    - `/curse tasks`
8. Suppress conflicting vanilla messages
9. Validate no UI path mutates game state
10. **Verify that all code written during this milestone was commented at creation time**

---

## 12. Result After M10

- Players can understand the game without debug tools
- Episodes feel like real, bounded play sessions
- Team competition is visible but not over-explained
- Curses remain mysterious and experiential
- CURSED now feels like a game, not a black box
