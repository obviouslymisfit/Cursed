# CURSED — Milestone M11
## Post-Run Shutdown & Player Return (No Rewards)

---

## 0. CRITICAL IMPLEMENTATION RULE (APPLIES TO THIS AND ALL FUTURE MILESTONES)

When implementing this milestone (and every milestone thereafter):

- **All non-trivial code MUST include explicit, explanatory comments**
- Comments must:
    - explain **what the code does**
    - explain **why it exists**
    - explain **how it fits into the larger system**
- Comments must be written so that:
    - a third party with no prior context
    - or a future maintainer months/years later  
      can understand the intent and structure without external documentation

This is not optional.  
Lack of clear comments is considered incomplete implementation.

### COMMENTING RULE (CLARIFICATION — NON-NEGOTIABLE)

- Comments are written **at the moment code is created**, not afterward.
- There is **no separate “commenting phase”**.
- No class, method, or non-trivial logic may exist without comments explaining:
    - its responsibility
    - its boundaries
    - and why it exists at that location in the system.
- If a piece of code cannot be clearly commented while being written, implementation **must pause** and the design must be reconsidered.
- “We will add comments later” is considered **invalid and incomplete implementation**.

---

## 1. Purpose of M11

Milestone M11 implements the **final shutdown behavior** that happens when a run ends.

There are **no post-run rewards** and nothing persists across runs as “meta progression”.  
Once the run is terminal, the game is over.

M11 ensures:
- terminal runs are cleanly shut down
- players are returned to the spawn platform in a controlled way
- any players joining after run end are placed at spawn platform immediately
- runtime systems do not continue operating after terminal state

This milestone does not modify win logic or standings. Those are already handled by M7/M8 and displayed via M10.

---

## 2. Scope

### Included in M11
- Post-run “cooldown window” (short delay)
- Teleport all online players to spawn platform after delay
- Force-teleport joiners to spawn platform while run is terminal
- Ensure all runtime systems are stopped/frozen in terminal state
- Debug/admin inspection for post-run state (minimal)

### Explicitly Excluded from M11
- Rewards of any kind
- Any carryover to future runs
- Automatic starting of new runs
- World resets, rollbacks, or cleanup
- Any retroactive score modifications

---

## 3. Terminal Run Shutdown (Timing)

### Locked rule: delayed return to spawn platform

When the run enters any terminal state:
- COMPLETED
- FAILED
- ABORTED

M11 schedules a delayed action:
- after a short delay (configurable constant for now)
- teleport all online players to the spawn platform

### Why delayed
This allows:
- terminal titles/subtitles to display (M10)
- final chat messaging to be seen
- a short “wrap-up moment” before players are reset to the platform

---

## 4. Spawn Platform Return (Authoritative)

### Teleport targets
- All online players
- Regardless of team
- Regardless of dimension

### Teleport semantics
- Server-side only
- Safe teleport (no void, no suffocation)
- Players should arrive to the platform reliably

### State safety
Teleport must not:
- mutate scores
- mutate objectives/tasks
- alter terminal outcome snapshot

Teleport is purely “session positioning”.

---

## 5. Join Handling While Run Is Terminal (Locked)

If a player joins while the run is terminal:
- they are immediately forced to the spawn platform

This prevents:
- spawning into a “dead run” in random locations
- confusion about run state
- accidental interaction with leftover world context

This is a join-time check only; it does not create new episodes or resume runs.

---

## 6. Runtime System Shutdown Guarantees

Even though M7 defines freeze semantics, M11 reinforces that:

When run is terminal:
- no objective/task progress updates
- no phase advancement
- no scoring changes
- no curse evaluation or rotation
- no penalties applied
- no episode countdown logic should continue

M11 must not implement these systems again, only ensure terminal run state truly stops them in practice.

---

## 7. Configuration

### Delay duration
The post-run teleport delay should be:
- configurable (data/config or constant in early implementation)
- applied consistently for all terminal outcomes

The exact number is not a balance concern; it’s a usability/pacing concern.

---

## 8. Debug / Admin Observability (Minimal)

Debug/admin command(s) may expose:
- whether a teleport-to-platform is pending
- remaining delay time (if tracked)

This is for testing reliability only.

No player-facing command is needed.

---

## 9. Explicit Implementation Steps (STRICT ORDER)

1. Add a post-run shutdown scheduler (server-side)
2. On transition into terminal state:
    - schedule teleport-to-platform after delay
3. Implement “teleport all online players to spawn platform”
4. Add join hook:
    - if run is terminal → teleport joiner immediately to spawn platform
5. Ensure teleport scheduling is idempotent (only once per terminal transition)
6. Validate across outcomes:
    - COMPLETED
    - FAILED
    - ABORTED
7. Validate restart safety:
    - if server restarts while terminal, joining players still get sent to platform
    - pending teleport behavior is safe and non-destructive
8. (Optional) Add debug/admin visibility for pending teleport
9. **Verify that all code written during this milestone was commented at creation time**

---

## 10. Result After M11

- When the run ends, players get a short wrap-up moment
- Then all players are reliably returned to the spawn platform
- Late joiners never spawn into a “dead run”
- No systems continue operating after terminal state
- The game ends cleanly with no post-run rewards or persistence
